<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BRAWL LETTERS – קרב האותיות</title>
  <meta name="theme-color" content="#0b1020" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="buildBanner" style="position:fixed;top:0;left:0;right:0;z-index:9999999;background:#ff2d55;color:#fff;padding:8px 12px;font-weight:900;text-align:center;font-family:system-ui,-apple-system,Segoe UI,Roboto">
    BUILD v61 ✅
  </div>
  <div style="height:44px"></div>

  <header class="top">
    <div class="brand">
      <div class="logo" aria-hidden="true">BL</div>
      <div class="titleWrap">
        <div class="title">BRAWL LETTERS</div>
        <div class="subtitle">קרב האותיות – משחק מהיר ואנרגטי</div>
      </div>
    </div>

    <div class="controls">
      <button id="btnParentToggle" class="btn" type="button" title="הורה: אותיות">👨‍👩‍👦</button>
      <button id="btnLogo" class="btn" type="button" title="לוגו שלי">🧩</button>
      <button id="btnSound" class="btn" type="button" title="הקרא">🔊</button>
      <button id="btnSettings" class="btn" type="button" title="הגדרות">⚙️</button>
      <button id="btnReset" class="btn" type="button" title="איפוס">🔄</button>
    </div>
  </header>

  <main class="wrap">
    <section id="screenHome" class="screen">
      <div class="panel hero">
        <div class="heroBadge">לנדב בן 6</div>
        <h1>קרב האותיות!</h1>
        <p class="muted">בחר בראולר, תקבל משימה, ותנצח את הבוס ⭐</p>

        <div class="homeStats">
          <div class="statMini"><span>🪙</span> <strong id="coinsTotal">0</strong> / 1000</div>
          <div class="statMini"><span>⭐</span> <strong id="starsTotal">0</strong></div>
          <div class="statMini"><span>🔥</span> <strong id="streak">0</strong></div>
        </div>

        <div class="homeBtns">
          <button id="btnPlay" class="btn primary big" type="button" onclick="window.__startGame && window.__startGame()">🎮 התחל משחק</button>
          <button id="btnOpenBrawlers" class="btn big" type="button">🦸 בחירת בראולר</button>
        </div>
        <div class="tiny" id="homeLettersHint"></div>
      </div>

      <div class="panel">
        <h2>איך מנצחים?</h2>
        <p class="muted">
          כל ניחוש נכון נותן ⭐. תלחץ על הכוכב כדי לקבל 🪙 מטבעות זהב רנדומליים.
          מגיעים ל-<strong>1000</strong> מטבעות? ניצחת!
        </p>
        <div class="tiny">טיפ: כדי “להתקין” באייפון/אייפד: Share → Add to Home Screen.</div>
      </div>
    </section>
<section id="screenSelect" class="screen hidden"></section>



    <section id="screenFight" class="screen" hidden>
      <div class="panel fightTop">
        <div class="rowBetween">
          <div class="pill" id="bossPill"></div>
  <div class="pill" id="currentBrawlerPill">בחר בראולר</div>
          <div class="fightStats">
            <div class="statMini"><span>🪙</span> <strong id="coinsHud">0</strong></div>
            <div class="statMini"><span>⭐</span> <strong id="starsRound">0</strong></div>
          </div>
        </div>

        <div class="prompt" id="prompt">איזו אות שומעים בתחילת המילה?</div>

        <div class="wordWrap">
          <div class="word" id="wordMasked">_</div>
          <button id="btnRepeat" class="btn small" type="button">🔊 השמע מילה</button>
          <button id="btnReveal" class="btn small" type="button">👀 גלה אות</button>
        </div>

        <div class="choices" id="choices"></div>

        <div class="feedback" id="feedback" aria-live="polite"></div>

        <div class="reward" id="reward" hidden>
          <button id="btnStar" class="starBtn" type="button" aria-label="קבל מטבעות" disabled>⭐</button>
          <div class="rewardText" id="rewardText">לחץ על הכוכב!</div>
          <div class="coinsPop" id="coinsPop" hidden>+100 🪙</div>
        </div>

        <div class="fightFooter">
          <button id="btnTryAgain" class="btn" type="button" hidden>נסה שוב</button>
          <button id="btnChangeBrawler" class="btn primary" type="button">החלף בראולר</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Logo Picker (Popup) -->
  <div id="logoModal" class="modal hidden" role="dialog" aria-modal="true" aria-label="בחירת לוגו">
    <div class="modalBackdrop" id="logoModalBackdrop"></div>
    <div class="modalCard">
      <div class="modalHeader">
        <div class="modalTitle">בחר לוגו למשחק</div>
        <button id="btnCloseLogoModal" class="btn" type="button" aria-label="סגור">✕</button>
      </div>
      <div class="modalBody">
        <div class="rowBetween">
          <div class="pill" id="modePill">רנדומלי</div>
          <div class="tiny" id="selectHint"></div>
        </div>
        <div class="brawlers" id="brawlers"></div>
      </div>
    </div>
  </div>


  <dialog id="lettersDialog">
    <div class="dialog">
      <div class="rowBetween">
        <h2 style="margin:0">בחירת אותיות להתמקדות</h2>
        <button id="btnCloseLetters" class="btn" type="button">סגור</button>
      </div>
      <p class="muted" style="margin-top:10px">לחצו על אות כדי לסמן/לבטל. סגור = שומר וחוזר למשחק.</p>

      <div class="pickerToolbar">
        <button class="btn" id="btnPickAll" type="button">בחר הכל</button>
        <button class="btn" id="btnPickNone" type="button">נקה</button>
        <button class="btn" id="btnPresetNadav" type="button">נדב: ס כ ר ט</button>
      </div>

      <div class="lettersGrid" id="lettersGrid"></div>

      <div class="pickerFooter">
        <div class="tiny" id="pickedCount"></div>
        <div class="tiny">אפשר לפתוח/לסגור גם עם כפתור 👨‍👩‍👦 למעלה</div>
      </div>
    </div>
  </dialog>

  <dialog id="settingsDialog">
    <form method="dialog" class="dialog">
      <h2>הגדרות</h2>

      <div class="hr"></div>
      <h3 class="subTitle">שחקן</h3>

      <label class="row">
        <span>בחר שחקן</span>
        <select id="playerSelect"></select>
      </label>

      <div class="rowBetween">
        <button id="btnAddPlayer" class="btn" type="button">➕ הוסף שחקן</button>
        <button id="btnRenamePlayer" class="btn" type="button">✏️ שנה שם</button>
      </div>


      <label class="row">
        <span>הקראה אוטומטית</span>
        <select id="autospeakSelect">
          <option value="on" selected>כן</option>
          <option value="off">לא</option>
        </select>
      </label>

      <label class="row">
        <span>מהירות הקראה</span>
        <input id="rateInput" type="range" min="0.7" max="1.2" step="0.05" value="0.95" />
      </label>

      
      <div class="hr"></div>
      <h3 class="subTitle">כלים</h3>

      <label class="row">
        <span>מצב Debug</span>
        <select id="debugToggle">
          <option value="off" selected>כבוי</option>
          <option value="on">דלוק</option>
        </select>
      </label>
      <p class="tiny muted">כשדלוק, תופיע תיבת DEBUG למטה (לפתרון תקלות).</p>

      <menu class="menu">
        <button class="btn" value="cancel">סגור</button>
        <button class="btn primary" id="btnSaveSettings" value="default">שמור</button>
      </menu>

      <p class="tiny">הערה: הקראה תלויה בקול עברי במכשיר.</p>
    </form>
  </dialog>

  <dialog id="winDialog">
    <div class="dialog">
      <h2>🎉 ניצחת!</h2>
      <p class="muted">הגעת ל-1000 מטבעות זהב 🪙</p>
      <div class="rowBetween">
        <button id="btnKeepPlaying" class="btn primary" type="button">להמשיך לשחק</button>
        <button id="btnResetCoins" class="btn" type="button">איפוס מטבעות</button>
      </div>
      <p class="tiny">טיפ: אפשר להחליף אותיות עם 👨‍👩‍👦 למעלה.</p>
    </div>
  </dialog>

  <script src="app.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js");
    }
  </script>

  <div id="debugPanel" class="debugPanel hidden"></div>

  <div id="modalUnlock" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modalCard">
      <div class="modalTitle">🎁 קיבלת לוגו חדש!</div>
      <div class="modalSubtitle">הגעת ל־<span id="unlockStars">100</span> כוכבים. בחר לוגו חדש להוסיף לאוסף:</div>
      <div id="unlockGrid" class="logoGrid"></div>
      <div class="modalActions">
        <button id="btnUnlockLater" class="btn">אחר כך</button>
      </div>
    </div>
  </div>


  <div id="earlyDebug" style="position:fixed;bottom:10px;left:10px;right:10px;z-index:9999998;background:rgba(0,0,0,.78);color:#fff;padding:10px;border-radius:12px;font-family:ui-monospace,Menlo,monospace;font-size:12px">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:8px">
      <strong>DEBUG</strong>
      <div style="display:flex;gap:8px">
        <button id="dbgCopy" style="padding:6px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff">העתק</button>
        <button id="dbgClear" style="padding:6px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff">נקה</button>
        <button id="dbgHide" style="padding:6px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff">הסתר</button>
      </div>
    </div>
    <pre id="dbgLog" style="margin:0;max-height:26vh;overflow:auto;white-space:pre-wrap;word-break:break-word"></pre>
  </div>
  <script>
  (function(){
    const logEl = document.getElementById("dbgLog");
    function log(msg){ try{ logEl.textContent += msg + "\n"; }catch(e){} }
    window.__DBGLOG = log;
    window.__DBGSHOW = function(show){ try{ root.style.display = show ? "" : "none"; }catch(e){} };

    log("[BOOT] early debug script ran ✅");
    window.addEventListener("error", (e)=>{ log("[ERROR] " + e.message + " @" + e.filename + ":" + e.lineno + ":" + e.colno); });
    window.addEventListener("unhandledrejection", (e)=>{ log("[PROMISE] " + (e.reason && (e.reason.stack||e.reason.message||e.reason))); });
    document.getElementById("dbgCopy").addEventListener("click", async ()=>{ try{ await navigator.clipboard.writeText(logEl.textContent||""); log("[COPY] ok"); }catch(e){ log("[COPY] failed " + e); } });
    document.getElementById("dbgClear").addEventListener("click", ()=>{ logEl.textContent=""; log("[CLEAR]"); });
    document.getElementById("dbgHide").addEventListener("click", ()=>{ document.getElementById("earlyDebug").style.display="none"; });
  })();
  </script>

</body>
</html>